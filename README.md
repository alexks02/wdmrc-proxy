# docker/wdmrc-proxy

WebDav proxy to Mail.ru Cloud  
Author [yar229](https://github.com/yar229) ([GitHub](https://github.com/yar229/WebDavMailRuCloud))

## Предисловие

```text
т.к. с разговорным английским у меня, мягко говоря, хреновато,
а использовать автопереводчики не хочу, описание этого чуда будет на русском...
```

в связи с тем, что данный образ вдруг появился в описании к самой проксе,  
подумал что было бы не плохо написать пару строчек о моей поделке.

## Причины и следствия

* Почему было принято решение использовать **Docker**
  1. портативность: быстро и без танцев разворачивается на новой машине.
  2. меньше мусора: если прокси перестанет быть необходимой,  
     удаляется без хвостов и необходимости подчищать пакеты-зависимости.
* Почему в качестве базового образа используется поделка с _supervisord_ на борту
  * у Docker'а крайне печально с пробуждением сервисов,  
    завязанных на сетевых протаколах после спячки (особенно на windows).  
    политика _restart=always_ у контейнера частично решает проблему,  
    однако были выявлены случаи когда контейнер попросту повисал,  
    что приводило к следующему сценарию: контейнер запущен,  
    сервис в нём вроде бы так же запущен, однако ни на какие внешние "раздражители"  
    (ни запросы, ни telnet на порт) сервис не реагирует,  
    что собственно и породило идею приплести некую приблуду,  
    которая будет мониторить состояние сервиса и перезапускать его, если понадобится.  
    так появился супервизор в контейнере, и, по изложенным выше причинам,  
    избавляться от него я не планирую.

## Запуск

По умолчанию, WDMRC слушает порт 8010 на всех адресах.

```text
docker run -d --restart always \
           --name wdmrc-proxy \
           -p 8010:8010 \
           slothds/wdmrc-proxy:stable
```

### Дополнительные параметры

Для смены заданных по умолчанию параметров используются переменные окружения:

```text
WDMRC_HOST - адрес, который будет слушать WDMRC
WDMRC_PORT - порт подключения к WDMRC
WDMRC_ARGS - дополнительные аргументы запуска прокси
```

#### Пример

Запуск прокси с использованием сети host машины,  
с прослушиванием только localhost:8080,  
максимальным числом потоков = 10 и подключением по протоколу WebV2

```text
docker run -d --net=host \
           --name=wdmrc-proxy \
           --env=WDMRC_HOST=http://127.0.0.1 \
           --env=WDMRC_PORT=8080 \
           --env=WDMRC_ARGS="--maxthreads=10 --protocol=WebV2" \
           slothds/wdmrc-proxy:stable
```

## Как пользоваться

т.к. данная утилита - это просто прокси, транслирующая запросы от вашего _webdav_ клинта  
к сервисам mail.ru, вам, собственно, потребуется _webdav_ клиент.  
Более детально с данным вопросом лучше ознакомиться в документации от автора:  
[Чтиво](https://github.com/yar229/WebDavMailRuCloud/blob/master/readme.md) | [FAQ на русском](https://gist.github.com/yar229/4b702af114503546be1fe221bb098f27)  
  
**WebDav URL** в клиенте указываете: `http://localhost:8010`
